{% extends 'dashboard/base.html' %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞–º–∏{% endblock %}

{% block extra_head %}
<style>
    .hierarchy-line {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: linear-gradient(to bottom, #8b5cf6, #6366f1, #3b82f6);
        border-radius: 2px;
    }
    .building-card {
        border-left: 4px solid #8b5cf6;
        background: linear-gradient(to right, #faf5ff 0%, #ffffff 10%);
    }
    .floor-card {
        border-left: 3px solid #6366f1;
        background: linear-gradient(to right, #eef2ff 0%, #ffffff 8%);
        margin-left: 1.5rem;
    }
    .room-card {
        border-left: 2px solid #3b82f6;
        background: linear-gradient(to right, #eff6ff 0%, #ffffff 5%);
        margin-left: 3rem;
    }
    .hierarchy-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.875rem;
    }
    .badge-building {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
    }
    .badge-floor {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        color: white;
    }
    .badge-room {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-6 md:mb-8">
    <div class="mb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞–º–∏</h1>
        <p class="text-sm md:text-base text-gray-600">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –¥–ª—è –Ω–æ–º–µ—Ä–æ–≤ –æ—Ç–µ–ª—è</p>
    </div>
    <div class="flex flex-wrap gap-2 md:gap-4">
        <a href="{% url 'generate_qr_images' %}?include_buildings=true&include_floors=true" class="flex-1 sm:flex-none bg-indigo-600 text-white px-4 py-2.5 md:px-6 md:py-3 rounded-lg hover:bg-indigo-700 transition font-medium text-center text-sm md:text-base touch-manipulation shadow-lg hover:shadow-xl">
            üì¶ –°–∫–∞—á–∞—Ç—å –≤—Å–µ QR-–∫–æ–¥—ã
        </a>
        <a href="{% url 'dashboard_building_add' %}" class="flex-1 sm:flex-none bg-purple-600 text-white px-4 py-2.5 md:px-6 md:py-3 rounded-lg hover:bg-purple-700 transition font-medium text-center text-sm md:text-base touch-manipulation shadow-lg hover:shadow-xl">
            + –ö–æ—Ä–ø—É—Å
        </a>
        <a href="{% url 'dashboard_floor_add' %}" class="flex-1 sm:flex-none bg-blue-600 text-white px-4 py-2.5 md:px-6 md:py-3 rounded-lg hover:bg-blue-700 transition font-medium text-center text-sm md:text-base touch-manipulation shadow-lg hover:shadow-xl">
            + –≠—Ç–∞–∂
        </a>
        <a href="{% url 'dashboard_room_add' %}" class="flex-1 sm:flex-none bg-green-600 text-white px-4 py-2.5 md:px-6 md:py-3 rounded-lg hover:bg-green-700 transition font-medium text-center text-sm md:text-base touch-manipulation shadow-lg hover:shadow-xl">
            + –ù–æ–º–µ—Ä
        </a>
    </div>
</div>

<div class="space-y-6">
    {% for building in buildings %}
    <!-- –ö–æ—Ä–ø—É—Å (–≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å) -->
    <div class="building-card rounded-xl shadow-lg p-5 md:p-6 relative overflow-hidden">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
                <span class="hierarchy-badge badge-building">
                    üè¢ –ö–æ—Ä–ø—É—Å
                </span>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">{{ building.name }}</h2>
            </div>
            <div class="flex gap-2">
                {% if building.qr_code %}
                <button onclick="regenerateBuildingQR({{ building.id }}, '{{ building.name }}')" 
                        class="bg-blue-600 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-blue-700 transition font-medium text-sm md:text-base touch-manipulation shadow-md hover:shadow-lg" 
                        title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –∫–æ—Ä–ø—É—Å–∞">
                    üîÑ QR
                </button>
                {% endif %}
                <button onclick="deleteBuilding({{ building.id }}, '{{ building.name }}', {{ building.floors.count }}, {{ building.total_rooms }})" 
                        class="bg-red-600 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-red-700 transition font-medium text-sm md:text-base touch-manipulation shadow-md hover:shadow-lg">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
        
        {% if building.qr_code %}
        <div class="mb-5 p-4 bg-white rounded-lg border-2 border-purple-200 shadow-sm">
            <div class="flex items-center gap-4">
                <div class="flex-shrink-0">
                    <img src="{{ building.qr_code.url }}" alt="QR Code Building" class="w-32 h-32 object-contain border-2 border-purple-100 rounded-lg p-2">
                </div>
                <div class="flex-grow">
                    <h3 class="font-semibold text-gray-700 mb-2 text-lg">QR-–∫–æ–¥ –∫–æ—Ä–ø—É—Å–∞</h3>
                    <p class="text-xs text-gray-500 mb-2 font-mono">Slug: {{ building.slug }}</p>
                    <a href="/building/{{ building.slug }}/" target="_blank" class="inline-block text-sm text-purple-600 hover:text-purple-800 font-medium hover:underline">
                        üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—Ä–ø—É—Å–∞
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- –≠—Ç–∞–∂–∏ (—Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å) -->
        {% for floor in building.floors.all %}
        <div class="floor-card rounded-lg shadow-md p-4 md:p-5 mb-4 relative">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <span class="hierarchy-badge badge-floor">
                        üìç –≠—Ç–∞–∂
                    </span>
                    <h3 class="text-lg md:text-xl font-bold text-gray-800">{{ floor.name }}</h3>
                </div>
                <div class="flex gap-2">
                    {% if floor.qr_code %}
                    <button onclick="regenerateFloorQR({{ floor.id }}, '{{ floor.name }}')" 
                            class="bg-blue-600 text-white px-2 py-1 md:px-3 md:py-1.5 rounded-lg hover:bg-blue-700 transition font-medium text-xs md:text-sm touch-manipulation shadow-sm hover:shadow-md" 
                            title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ —ç—Ç–∞–∂–∞">
                        üîÑ QR
                    </button>
                    {% endif %}
                    <button onclick="deleteFloor({{ floor.id }}, '{{ floor.name }}', '{{ building.name }}', {{ floor.rooms.count }})" 
                            class="bg-red-600 text-white px-2 py-1 md:px-3 md:py-1.5 rounded-lg hover:bg-red-700 transition font-medium text-xs md:text-sm touch-manipulation shadow-sm hover:shadow-md">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            
            {% if floor.qr_code %}
            <div class="mb-4 p-3 bg-white rounded-lg border-2 border-indigo-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0">
                        <img src="{{ floor.qr_code.url }}" alt="QR Code Floor" class="w-28 h-28 object-contain border-2 border-indigo-100 rounded-lg p-2">
                    </div>
                    <div class="flex-grow">
                        <h3 class="font-semibold text-gray-700 mb-2">QR-–∫–æ–¥ —ç—Ç–∞–∂–∞</h3>
                        <p class="text-xs text-gray-500 mb-2 font-mono">Slug: {{ floor.slug }}</p>
                        <a href="/floor/{{ floor.slug }}/" target="_blank" class="inline-block text-sm text-indigo-600 hover:text-indigo-800 font-medium hover:underline">
                            üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —ç—Ç–∞–∂–∞
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- –ù–æ–º–µ—Ä–∞ (–Ω–∏–∂–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å) -->
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                {% for room in floor.rooms.all %}
                <div class="room-card border-2 border-blue-200 rounded-lg p-3 md:p-4 hover:border-blue-400 hover:shadow-md transition-all relative bg-white">
                    <div class="absolute top-1 right-1 flex gap-1 z-10">
                        <button onclick="regenerateQR({{ room.id }}, '{{ room.number }}')" 
                                class="bg-blue-600 text-white p-1 rounded hover:bg-blue-700 transition text-xs touch-manipulation shadow-sm" 
                                title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥">
                            üîÑ
                        </button>
                        <button onclick="deleteRoom({{ room.id }}, '{{ room.number }}', {{ room.orders.count }})" 
                                class="bg-red-600 text-white p-1 rounded hover:bg-red-700 transition text-xs touch-manipulation shadow-sm" 
                                title="–£–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä">
                            üóëÔ∏è
                        </button>
                    </div>
                    <div class="text-center">
                        <div class="mb-2">
                            <span class="hierarchy-badge badge-room text-xs py-1 px-2">
                                üö™ –ù–æ–º–µ—Ä
                            </span>
                        </div>
                        {% if room.qr_code %}
                        <img src="{{ room.qr_code.url }}" alt="QR Code" class="w-full mb-2 border border-blue-100 rounded">
                        {% else %}
                        <div class="w-full h-24 bg-gray-100 rounded flex items-center justify-center mb-2 border-2 border-dashed border-gray-300">
                            <span class="text-gray-400 text-xs">–ù–µ—Ç QR</span>
                        </div>
                        {% endif %}
                        <p class="font-bold text-gray-900 text-base md:text-lg mb-1">{{ room.number }}</p>
                        <p class="text-xs text-gray-500 truncate font-mono mb-2">{{ room.slug }}</p>
                        <a href="/order/{{ room.slug }}/" target="_blank" class="text-xs text-blue-600 hover:text-blue-800 font-medium hover:underline inline-block">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    
    <!-- –≠—Ç–∞–∂–∏ –±–µ–∑ –∫–æ—Ä–ø—É—Å–∞ -->
    {% if floors %}
    <div class="bg-white rounded-xl shadow-lg p-5 md:p-6 border-2 border-gray-300">
        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-2xl">‚ö†Ô∏è</span>
            <span>–≠—Ç–∞–∂–∏ –±–µ–∑ –∫–æ—Ä–ø—É—Å–∞</span>
        </h2>
        {% for floor in floors %}
        <div class="floor-card rounded-lg shadow-md p-4 md:p-5 mb-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <span class="hierarchy-badge badge-floor">
                        üìç –≠—Ç–∞–∂
                    </span>
                    <h3 class="text-lg md:text-xl font-bold text-gray-800">{{ floor.name }}</h3>
                </div>
                <div class="flex gap-2">
                    {% if floor.qr_code %}
                    <button onclick="regenerateFloorQR({{ floor.id }}, '{{ floor.name }}')" 
                            class="bg-blue-600 text-white px-2 py-1 md:px-3 md:py-1.5 rounded-lg hover:bg-blue-700 transition font-medium text-xs md:text-sm touch-manipulation shadow-sm hover:shadow-md" 
                            title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ —ç—Ç–∞–∂–∞">
                        üîÑ QR
                    </button>
                    {% endif %}
                    <button onclick="deleteFloor({{ floor.id }}, '{{ floor.name }}', null, {{ floor.rooms.count }})" 
                            class="bg-red-600 text-white px-2 py-1 md:px-3 md:py-1.5 rounded-lg hover:bg-red-700 transition font-medium text-xs md:text-sm touch-manipulation shadow-sm hover:shadow-md">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            {% if floor.qr_code %}
            <div class="mb-4 p-3 bg-white rounded-lg border-2 border-indigo-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0">
                        <img src="{{ floor.qr_code.url }}" alt="QR Code Floor" class="w-28 h-28 object-contain border-2 border-indigo-100 rounded-lg p-2">
                    </div>
                    <div class="flex-grow">
                        <h3 class="font-semibold text-gray-700 mb-2">QR-–∫–æ–¥ —ç—Ç–∞–∂–∞</h3>
                        <p class="text-xs text-gray-500 mb-2 font-mono">Slug: {{ floor.slug }}</p>
                        <a href="/floor/{{ floor.slug }}/" target="_blank" class="inline-block text-sm text-indigo-600 hover:text-indigo-800 font-medium hover:underline">
                            üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —ç—Ç–∞–∂–∞
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                {% for room in floor.rooms.all %}
                <div class="room-card border-2 border-blue-200 rounded-lg p-3 md:p-4 hover:border-blue-400 hover:shadow-md transition-all relative bg-white">
                    <div class="absolute top-1 right-1 flex gap-1 z-10">
                        <button onclick="regenerateQR({{ room.id }}, '{{ room.number }}')" 
                                class="bg-blue-600 text-white p-1 rounded hover:bg-blue-700 transition text-xs touch-manipulation shadow-sm" 
                                title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥">
                            üîÑ
                        </button>
                        <button onclick="deleteRoom({{ room.id }}, '{{ room.number }}', {{ room.orders.count }})" 
                                class="bg-red-600 text-white p-1 rounded hover:bg-red-700 transition text-xs touch-manipulation shadow-sm" 
                                title="–£–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä">
                            üóëÔ∏è
                        </button>
                    </div>
                    <div class="text-center">
                        <div class="mb-2">
                            <span class="hierarchy-badge badge-room text-xs py-1 px-2">
                                üö™ –ù–æ–º–µ—Ä
                            </span>
                        </div>
                        {% if room.qr_code %}
                        <img src="{{ room.qr_code.url }}" alt="QR Code" class="w-full mb-2 border border-blue-100 rounded">
                        {% else %}
                        <div class="w-full h-24 bg-gray-100 rounded flex items-center justify-center mb-2 border-2 border-dashed border-gray-300">
                            <span class="text-gray-400 text-xs">–ù–µ—Ç QR</span>
                        </div>
                        {% endif %}
                        <p class="font-bold text-gray-900 text-base md:text-lg mb-1">{{ room.number }}</p>
                        <p class="text-xs text-gray-500 truncate font-mono mb-2">{{ room.slug }}</p>
                        <a href="/order/{{ room.slug }}/" target="_blank" class="text-xs text-blue-600 hover:text-blue-800 font-medium hover:underline inline-block">
                            üîó –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if not buildings and not floors %}
    <div class="bg-white rounded-xl shadow-md p-12 text-center">
        <p class="text-gray-600 text-lg mb-4">–ù–æ–º–µ—Ä–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
        <a href="{% url 'dashboard_room_add' %}" class="text-indigo-600 hover:text-indigo-800 underline">
            –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä
        </a>
    </div>
    {% endif %}
</div>

<script>
function deleteBuilding(buildingId, buildingName, floorsCount, roomsCount) {
    const message = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ—Ä–ø—É—Å "${buildingName}"?\n\n` +
                   `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç:\n` +
                   `‚Ä¢ ${floorsCount} —ç—Ç–∞–∂(–µ–π)\n` +
                   `‚Ä¢ ${roomsCount} –Ω–æ–º–µ—Ä(–æ–≤)\n\n` +
                   `–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`;
    
    if (confirm(message)) {
        fetch(`/dashboard/building/${buildingId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ—Ä–ø—É—Å–∞');
        });
    }
}

function deleteFloor(floorId, floorName, buildingName, roomsCount) {
    const fullFloorName = buildingName ? `${buildingName} - ${floorName}` : floorName;
    const message = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${fullFloorName}"?\n\n` +
                   `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç:\n` +
                   `‚Ä¢ ${roomsCount} –Ω–æ–º–µ—Ä(–æ–≤)\n\n` +
                   `–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`;
    
    if (confirm(message)) {
        fetch(`/dashboard/floor/${floorId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç—Ç–∞–∂–∞');
        });
    }
}

function deleteRoom(roomId, roomNumber, ordersCount) {
    let message = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä "${roomNumber}"?\n\n`;
    
    if (ordersCount > 0) {
        message += `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –£ —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –µ—Å—Ç—å ${ordersCount} –∑–∞–∫–∞–∑(–æ–≤).\n` +
                  `–ù–æ–º–µ—Ä —Å –∑–∞–∫–∞–∑–∞–º–∏ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å. –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ –∑–∞–∫–∞–∑—ã.`;
        alert(message);
        return;
    }
    
    message += `–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`;
    
    if (confirm(message)) {
        fetch(`/dashboard/room/${roomId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –Ω–æ–º–µ—Ä–∞');
        });
    }
}

function regenerateFloorQR(floorId, floorName) {
    if (confirm(`–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è —ç—Ç–∞–∂–∞ "${floorName}"?`)) {
        fetch(`/dashboard/floor/${floorId}/regenerate-qr/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ —ç—Ç–∞–∂–∞');
        });
    }
}

function regenerateQR(roomId, roomNumber) {
    if (confirm(`–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è –Ω–æ–º–µ—Ä–∞ "${roomNumber}"?`)) {
        fetch(`/dashboard/room/${roomId}/regenerate-qr/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞');
        });
    }
}

function regenerateBuildingQR(buildingId, buildingName) {
    if (confirm(`–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è –∫–æ—Ä–ø—É—Å–∞ "${buildingName}"?`)) {
        fetch(`/dashboard/building/${buildingId}/regenerate-qr/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ –∫–æ—Ä–ø—É—Å–∞');
        });
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}

